# Изменения в MoonShine для событий/бронирований

## Обновленные страницы

### EventIndexPage (Список событий)
- ✅ Добавлены поля: `status`, `room`, `user`, `price`, `notes`
- ✅ Добавлены фильтры для всех новых полей
- ✅ Скрыты некоторые поля на индексе (description, booking_resource, user, price, notes)
- ✅ Добавлена фильтрация по статусу, ресурсам, комнатам, пользователям

### EventFormPage (Форма создания/редактирования)
- ✅ Добавлены поля: `room_id`, `user_id`, `status`, `notes`, `price`
- ✅ Поле `room` фильтруется по выбранному ресурсу
- ✅ Поле `room` показывает только комнаты с `rent = true`
- ✅ Добавлена валидация всех полей
- ✅ Валидация уникальности имени с учетом текущей записи

### EventDetailPage (Детальная страница)
- ✅ Добавлены все новые поля для отображения
- ✅ Показываются связи с ресурсами, комнатами и пользователями

## Observer для проверки доступности

### EventObserver
- ✅ Автоматическая проверка доступности при создании бронирования
- ✅ Автоматическая проверка доступности при обновлении критических полей
- ✅ Исключение отмененных бронирований из проверки
- ✅ Выброс ValidationException при конфликтах времени

**Зарегистрирован в**: `AppServiceProvider::boot()`

## Валидация

### Правила валидации в EventFormPage
- `name` - обязательное, уникальное, максимум 255 символов
- `description` - опциональное
- `active` - boolean
- `status` - один из: pending, confirmed, cancelled, completed
- `booking_resource_id` - опциональное, существует в resources
- `booked_resource_id` - опциональное, существует в resources
- `room_id` - опциональное, существует в rooms
- `user_id` - опциональное, существует в users
- `start_at` - опциональное, дата
- `end_at` - опциональное, дата, должна быть позже start_at
- `notes` - опциональное
- `price` - опциональное, число, минимум 0

## Особенности работы

### Автоматическая проверка доступности
При сохранении события через MoonShine:
1. Если указаны `booked_resource_id`, `start_at` и `end_at` → это бронирование
2. Observer автоматически проверяет доступность
3. Если время занято → выбрасывается ValidationException
4. Пользователь видит ошибку в форме

### Фильтрация комнат
- В форме выбора комнаты показываются только комнаты выбранного ресурса
- Показываются только комнаты с `rent = true` (доступные для аренды)

### Значения по умолчанию
- `status` → `pending`
- `user_id` → текущий пользователь (если не указан)
- `active` → `true`

## Использование

### Создание бронирования через MoonShine
1. Заполните обязательные поля: `name`, `booked_resource_id`, `start_at`, `end_at`
2. Опционально выберите `room_id` для бронирования конкретной комнаты
3. Выберите `status` (по умолчанию `pending`)
4. Укажите `price` и `notes` при необходимости
5. Сохраните

### Фильтрация в списке
- По статусу: выберите статус в фильтре
- По ресурсу: выберите `booked_resource` в фильтре
- По комнате: выберите `room` в фильтре
- По пользователю: выберите `user` в фильтре
- По дате: используйте `start_at` и `end_at` фильтры

## Обработка ошибок

Если при сохранении бронирования возникает конфликт времени:
- Пользователь увидит сообщение: "Выбранное время уже занято. Пожалуйста, выберите другое время."
- Форма не будет сохранена
- Нужно изменить время или выбрать другой ресурс/комнату

